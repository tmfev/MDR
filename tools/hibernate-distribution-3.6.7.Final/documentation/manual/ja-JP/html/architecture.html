<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">第2章 アーキテクチャ</title><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java"/><link rel="up" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java"/><link rel="prev" href="tutorial.html" title="第1章 Tutorial"/><link rel="next" href="session-configuration.html" title="第3章 設定"/><link rel="copyright" href="Legal_Notice.html" title="Legal Notice"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="tutorial.html"><strong>前のページ</strong></a></li><li class="next"><a accesskey="n" href="session-configuration.html"><strong>次のページ</strong></a></li></ul><div class="chapter" lang="ja-JP"><div class="titlepage"><div><div><h2 class="title"><a id="architecture"/>第2章 アーキテクチャ</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="architecture.html#architecture-overview">2.1. 概観</a></span></dt><dd><dl><dt><span class="section"><a href="architecture.html#architecture-overview-minimal">2.1.1. Minimal architecture</a></span></dt><dt><span class="section"><a href="architecture.html#architecture-overview-comprehensive">2.1.2. Comprehensive architecture</a></span></dt><dt><span class="section"><a href="architecture.html#architecture-overview-terms">2.1.3. Basic APIs</a></span></dt></dl></dd><dt><span class="section"><a href="architecture.html#architecture-jmx">2.2. JMX との統合</a></span></dt><dt><span class="section"><a href="architecture.html#architecture-current-session">2.3. コンテキスト上のセッション</a></span></dt></dl></div><div class="section" lang="ja-JP"><div class="titlepage"><div><div><h2 class="title"><a id="architecture-overview"/>2.1. 概観</h2></div></div></div><p>Hibernate アーキテクチャの（非常に）高いレベルからのビュー： </p><div class="mediaobject" align="center"><img src="images/overview.png" align="middle"/></div><p>Unfortunately we cannot provide a detailed view of all possible runtime architectures. Hibernate is sufficiently flexible to be used in a number of ways in many, many architectures. We will, however, illustrate 2 specifically since they are extremes. </p><div class="section" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="architecture-overview-minimal"/>2.1.1. Minimal architecture</h3></div></div></div><p>The "minimal" architecture has the application manage its own JDBC connections and provide those connections to Hibernate; additionally the application manages transactions for itself. This approach uses a minimal subset of Hibernate APIs. </p><div class="mediaobject" align="center"><img src="images/lite.png" align="middle"/></div></div><div class="section" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="architecture-overview-comprehensive"/>2.1.2. Comprehensive architecture</h3></div></div></div><p>The "comprehensive" architecture abstracts the application away from the underlying JDBC/JTA APIs and allows Hibernate to manage the details. </p><div class="mediaobject" align="center"><img src="images/full_cream.png" align="middle"/></div></div><div class="section" lang="ja-JP"><div class="titlepage"><div><div><h3 class="title"><a id="architecture-overview-terms"/>2.1.3. Basic APIs</h3></div></div></div><p>Here are quick discussions about some of the API objects depicted in the preceding diagrams (you will see them again in more detail in later chapters). </p><div class="variablelist"><dl><dt><span class="term">SessionFactory (<code class="interfacename">org.hibernate.SessionFactory</code>)</span></dt><dd><p>A thread-safe, immutable cache of compiled mappings for a single database. A factory for <code class="interfacename">org.hibernate.Session</code> instances. A client of <code class="interfacename">org.hibernate.connection.ConnectionProvider</code>. Optionally maintains a <code class="literal">second level cache</code> of data that is reusable between transactions at a process or cluster level. </p></dd><dt><span class="term">Session (<code class="interfacename">org.hibernate.Session</code>)</span></dt><dd><p>A single-threaded, short-lived object representing a conversation between the application and the persistent store. Wraps a JDBC <code class="interfacename">java.sql.Connection</code>. Factory for <code class="interfacename">org.hibernate.Transaction</code>. Maintains a <code class="literal">first level cache</code> of persistent the application's persistent objects and collections; this cache is used when navigating the object graph or looking up objects by identifier. </p></dd><dt><span class="term">Persistent objects と Collections</span></dt><dd><p>Short-lived, single threaded objects containing persistent state and business function. These can be ordinary JavaBeans/POJOs. They are associated with exactly one <code class="interfacename">org.hibernate.Session</code>. Once the <code class="interfacename">org.hibernate.Session</code> is closed, they will be detached and free to use in any application layer (for example, directly as data transfer objects to and from presentation). <a class="xref" href="objectstate.html" title="第11章 オブジェクトを扱う">11章<i>オブジェクトを扱う</i></a> discusses transient, persistent and detached object states. </p></dd><dt><span class="term">Transient と detached な objects と Collections</span></dt><dd><p>Instances of persistent classes that are not currently associated with a <code class="interfacename">org.hibernate.Session</code>. They may have been instantiated by the application and not yet persisted, or they may have been instantiated by a closed <code class="interfacename">org.hibernate.Session</code>. <a class="xref" href="objectstate.html" title="第11章 オブジェクトを扱う">11章<i>オブジェクトを扱う</i></a> discusses transient, persistent and detached object states. </p></dd><dt><span class="term">Transaction (<code class="interfacename">org.hibernate.Transaction</code>)</span></dt><dd><p>(Optional) A single-threaded, short-lived object used by the application to specify atomic units of work. It abstracts the application from the underlying JDBC, JTA or CORBA transaction. A <code class="interfacename">org.hibernate.Session</code> might span several <code class="interfacename">org.hibernate.Transaction</code>s in some cases. However, transaction demarcation, either using the underlying API or <code class="interfacename">org.hibernate.Transaction</code>, is never optional. </p></dd><dt><span class="term">ConnectionProvider (<code class="interfacename">org.hibernate.connection.ConnectionProvider</code>)</span></dt><dd><p>(Optional) A factory for, and pool of, JDBC connections. It abstracts the application from underlying <code class="interfacename">javax.sql.DataSource</code> or <code class="interfacename">java.sql.DriverManager</code>. It is not exposed to application, but it can be extended and/or implemented by the developer. </p></dd><dt><span class="term">TransactionFactory (<code class="interfacename">org.hibernate.TransactionFactory</code>)</span></dt><dd><p>(Optional) A factory for <code class="interfacename">org.hibernate.Transaction</code> instances. It is not exposed to the application, but it can be extended and/or implemented by the developer. </p></dd><dt><span class="term"><span class="emphasis"><em>Extension Interfaces</em></span></span></dt><dd><p>Hibernate は、永続層の振る舞いをカスタマイズするために、多くのオプション拡張インタフェースを用意しています。詳細は API ドキュメントを参照してください。 </p></dd></dl></div><p>
            </p></div></div><div class="section" lang="ja-JP"><div class="titlepage"><div><div><h2 class="title"><a id="architecture-jmx"/>2.2. JMX との統合</h2></div></div></div><p>JMX は Java コンポーネント管理の J2EE 標準です。 JMX 標準サービスを通して、 Hibernate は管理されます。ディストリビューションの中に <code class="literal">org.hibernate.jmx.HibernateService</code> という MBean 実装を用意しています。 </p><p>Another feature available as a JMX service is runtime Hibernate statistics. See <a class="xref" href="session-configuration.html#configuration-optional-statistics" title="3.4.6. Hibernate 統計">「Hibernate 統計」</a> for more information. </p></div><div class="section" lang="ja-JP"><div class="titlepage"><div><div><h2 class="title"><a id="architecture-current-session"/>2.3. コンテキスト上のセッション</h2></div></div></div><p>Hibernate を使ったアプリケーションは、ほとんど、なんらかの形で「コンテキスト上の」セッションが必要になります。「コンテキスト上のセッション」は、特定のコンテキストのスコープのなかで有効なセッションのことです。しかし、通常アプリケーションごとにコンテキストを構成するものの定義は異なります。しかも、異なる複数のコンテキストは、現時点に対して異なるスコープを定義します。バージョン3.0より前の Hibernate では、自作の <code class="literal">ThreadLocal</code> ベースの「コンテキスト上のセッション」を利用するか、 <code class="literal">HibernateUtil</code> のようなヘルパークラスを利用するか、 proxy/interception ベースの「コンテキスト上のセッション」を提供する （Spring や Pico のような）サードパーティのフレームワークを利用するかのいずれかでした。 </p><p>Starting with version 3.0.1, Hibernate added the <code class="literal">SessionFactory.getCurrentSession()</code> method. Initially, this assumed usage of <code class="literal">JTA</code> transactions, where the <code class="literal">JTA</code> transaction defined both the scope and context of a current session. Given the maturity of the numerous stand-alone <code class="literal">JTA TransactionManager</code> implementations, most, if not all, applications should be using <code class="literal">JTA</code> transaction management, whether or not they are deployed into a <code class="literal">J2EE</code> container. Based on that, the <code class="literal">JTA</code>-based contextual sessions are all you need to use. </p><p>しかし、バージョン 3.1 からは、 <code class="literal">SessionFactory.getCurrentSession()</code> の後の処理が、プラガブルになりました。これを受けて、現在のセッションを定義するスコープとコンテキストのプラガビリティを可能にするために、新しい拡張インタフェース ( <code class="literal">org.hibernate.context.CurrentSessionContext</code> ) と新しい構成パラメータ ( <code class="literal">hibernate.current_session_context_class</code> ) が追加されました。 </p><p>See the Javadocs for the <code class="literal">org.hibernate.context.CurrentSessionContext</code> interface for a detailed discussion of its contract. It defines a single method, <code class="literal">currentSession()</code>, by which the implementation is responsible for tracking the current contextual session. Out-of-the-box, Hibernate comes with three implementations of this interface: </p><div class="itemizedlist"><ul><li><p><code class="literal">org.hibernate.context.JTASessionContext</code> - <code class="literal">JTA</code> トランザクションによって、現在のセッションが追跡され、スコープを決められます。この処理は、古い JTA だけのアプローチとまったく同じです。詳細は Javadoc を参照してください。 </p></li><li><p><code class="literal">org.hibernate.context.ThreadLocalSessionContext</code> - スレッドの実行によって、現在のセッションが追跡されます。詳細は Javadoc を参照してください。 </p></li><li><p><code class="literal">org.hibernate.context.ManagedSessionContext</code> - スレッドの実行によって、現在のセッションが追跡されます。しかし、このクラスの static メソッドで <code class="literal">Session</code> インスタンスをバインド/アンバインドする責任はあなたにあります。これは決して <code class="literal">Session</code> をオープン、フラッシュ、クローズしません。 </p></li></ul></div><p>The first two implementations provide a "one session - one database transaction" programming model. This is also known and used as <span class="emphasis"><em>session-per-request</em></span>. The beginning and end of a Hibernate session is defined by the duration of a database transaction. If you use programmatic transaction demarcation in plain JSE without JTA, you are advised to use the Hibernate <code class="literal">Transaction</code> API to hide the underlying transaction system from your code. If you use JTA, you can utilize the JTA interfaces to demarcate transactions. If you execute in an EJB container that supports CMT, transaction boundaries are defined declaratively and you do not need any transaction or session demarcation operations in your code. Refer to <a class="xref" href="transactions.html" title="第13章 Transactions and Concurrency">13章<i>Transactions and Concurrency</i></a> for more information and code examples. </p><p><code class="literal">hibernate.current_session_context_class</code> 設定パラメータは、 <code class="literal">org.hibernate.context.CurrentSessionContext</code> のどの実装を使うかを指定します。下位互換性のため、このパラメータが設定されず <code class="literal">org.hibernate.transaction.TransactionManagerLookup</code> が設定されていた場合、 Hibernate は <code class="literal">org.hibernate.context.JTASessionContext</code> を使うことに注意してください。通常このパラメータの値には、3つの実装の中から使用する実装クラスの名前を直接指定します。しかし、"jta"、 "thread"、 "managed"というそれぞれの省略名も用意されています。 </p></div></div><HR xmlns=""/><a xmlns="" href="legalnotice.html"><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">製作著作 © 2004 Red Hat, Inc.</p></a><ul class="docnav"><li class="previous"><a accesskey="p" href="tutorial.html"><strong>前のページ</strong>第1章 Tutorial</a></li><li class="up"><a accesskey="u" href="#"><strong>上に戻る</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>ホーム</strong></a></li><li class="next"><a accesskey="n" href="session-configuration.html"><strong>次のページ</strong>第3章 設定</a></li></ul></body></html>