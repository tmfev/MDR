<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">第 2 章 体系结构（Architecture）</title><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java"/><link rel="up" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java"/><link rel="prev" href="tutorial.html" title="第 1 章 教程"/><link rel="next" href="session-configuration.html" title="第 3 章 配置"/><link rel="copyright" href="Legal_Notice.html" title="Legal Notice"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="tutorial.html"><strong>上一页</strong></a></li><li class="next"><a accesskey="n" href="session-configuration.html"><strong>下一页</strong></a></li></ul><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="architecture"/>第 2 章 体系结构（Architecture）</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="architecture.html#architecture-overview">2.1. 概况（Overview）</a></span></dt><dd><dl><dt><span class="section"><a href="architecture.html#architecture-overview-minimal">2.1.1. Minimal architecture</a></span></dt><dt><span class="section"><a href="architecture.html#architecture-overview-comprehensive">2.1.2. Comprehensive architecture</a></span></dt><dt><span class="section"><a href="architecture.html#architecture-overview-terms">2.1.3. Basic APIs</a></span></dt></dl></dd><dt><span class="section"><a href="architecture.html#architecture-jmx">2.2. JMX 整合</a></span></dt><dt><span class="section"><a href="architecture.html#architecture-current-session">2.3. 上下文相关的会话（Contextual Session）</a></span></dt></dl></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="architecture-overview"/>2.1. 概况（Overview）</h2></div></div></div><p>下面的图表提供了 Hibernate 体系结构的高层视图： </p><div class="mediaobject" align="center"><img src="images/overview.png" align="middle"/></div><p>Unfortunately we cannot provide a detailed view of all possible runtime architectures. Hibernate is sufficiently flexible to be used in a number of ways in many, many architectures. We will, however, illustrate 2 specifically since they are extremes. </p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="architecture-overview-minimal"/>2.1.1. Minimal architecture</h3></div></div></div><p>The "minimal" architecture has the application manage its own JDBC connections and provide those connections to Hibernate; additionally the application manages transactions for itself. This approach uses a minimal subset of Hibernate APIs. </p><div class="mediaobject" align="center"><img src="images/lite.png" align="middle"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="architecture-overview-comprehensive"/>2.1.2. Comprehensive architecture</h3></div></div></div><p>“全面解决”的体系结构方案，将应用层从底层的 JDBC/JTA API 中抽象出来，而让 Hibernate 来处理这些细节。 </p><div class="mediaobject" align="center"><img src="images/full_cream.png" align="middle"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="architecture-overview-terms"/>2.1.3. Basic APIs</h3></div></div></div><p>Here are quick discussions about some of the API objects depicted in the preceding diagrams (you will see them again in more detail in later chapters). </p><div class="variablelist"><dl><dt><span class="term">SessionFactory (<code class="interfacename">org.hibernate.SessionFactory</code>)</span></dt><dd><p>A thread-safe, immutable cache of compiled mappings for a single database. A factory for <code class="interfacename">org.hibernate.Session</code> instances. A client of <code class="interfacename">org.hibernate.connection.ConnectionProvider</code>. Optionally maintains a <code class="literal">second level cache</code> of data that is reusable between transactions at a process or cluster level. </p></dd><dt><span class="term">Session (<code class="interfacename">org.hibernate.Session</code>)</span></dt><dd><p>A single-threaded, short-lived object representing a conversation between the application and the persistent store. Wraps a JDBC <code class="interfacename">java.sql.Connection</code>. Factory for <code class="interfacename">org.hibernate.Transaction</code>. Maintains a <code class="literal">first level cache</code> of persistent the application's persistent objects and collections; this cache is used when navigating the object graph or looking up objects by identifier. </p></dd><dt><span class="term">持久的对象及其集合</span></dt><dd><p>Short-lived, single threaded objects containing persistent state and business function. These can be ordinary JavaBeans/POJOs. They are associated with exactly one <code class="interfacename">org.hibernate.Session</code>. Once the <code class="interfacename">org.hibernate.Session</code> is closed, they will be detached and free to use in any application layer (for example, directly as data transfer objects to and from presentation). <a class="xref" href="objectstate.html" title="第 11 章 与对象共事">第 11 章 <i>与对象共事</i></a> discusses transient, persistent and detached object states. </p></dd><dt><span class="term">瞬态（transient）和脱管（detached）的对象及其集合</span></dt><dd><p>Instances of persistent classes that are not currently associated with a <code class="interfacename">org.hibernate.Session</code>. They may have been instantiated by the application and not yet persisted, or they may have been instantiated by a closed <code class="interfacename">org.hibernate.Session</code>. <a class="xref" href="objectstate.html" title="第 11 章 与对象共事">第 11 章 <i>与对象共事</i></a> discusses transient, persistent and detached object states. </p></dd><dt><span class="term">Transaction (<code class="interfacename">org.hibernate.Transaction</code>)</span></dt><dd><p>(Optional) A single-threaded, short-lived object used by the application to specify atomic units of work. It abstracts the application from the underlying JDBC, JTA or CORBA transaction. A <code class="interfacename">org.hibernate.Session</code> might span several <code class="interfacename">org.hibernate.Transaction</code>s in some cases. However, transaction demarcation, either using the underlying API or <code class="interfacename">org.hibernate.Transaction</code>, is never optional. </p></dd><dt><span class="term">ConnectionProvider (<code class="interfacename">org.hibernate.connection.ConnectionProvider</code>)</span></dt><dd><p>(Optional) A factory for, and pool of, JDBC connections. It abstracts the application from underlying <code class="interfacename">javax.sql.DataSource</code> or <code class="interfacename">java.sql.DriverManager</code>. It is not exposed to application, but it can be extended and/or implemented by the developer. </p></dd><dt><span class="term">TransactionFactory (<code class="interfacename">org.hibernate.TransactionFactory</code>)</span></dt><dd><p>(Optional) A factory for <code class="interfacename">org.hibernate.Transaction</code> instances. It is not exposed to the application, but it can be extended and/or implemented by the developer. </p></dd><dt><span class="term"><span class="emphasis"><em>Extension Interfaces</em></span></span></dt><dd><p>Hibernate 提供了很多可选的扩展接口，你可以通过实现它们来定制你的持久层的行为。具体请参考 API 文档。 </p></dd></dl></div><p>
            </p></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="architecture-jmx"/>2.2. JMX 整合</h2></div></div></div><p>JMX 是管理 Java 组件的 J2EE 标准。Hibernate 可以通过一个 JMX 标准服务来管理。在这个发行版本中，我们提供了一个 MBean 接口的实现,即 <code class="literal">org.hibernate.jmx.HibernateService</code>。  </p><p>Another feature available as a JMX service is runtime Hibernate statistics. See <a class="xref" href="session-configuration.html#configuration-optional-statistics" title="3.4.6. Hibernate 的统计（statistics）机制">第 3.4.6 节 “Hibernate 的统计（statistics）机制”</a> for more information. </p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="architecture-current-session"/>2.3. 上下文相关的会话（Contextual Session）</h2></div></div></div><p>使用 Hibernate 的大多数应用程序需要某种形式的“上下文相关的”会话，特定的会话在整个特定的上下文范围内始终有效。然而，对不同类型的应用程序而言，要为什么是组成这种“上下文”下一个定义通常是困难的；不同的上下文对“当前”这个概念定义了不同的范围。在 3.0 版本之前，使用 Hibernate 的程序要么采用自行编写的基于 <code class="literal">ThreadLocal</code> 的上下文会话，要么采用 <code class="literal">HibernateUtil</code> 这样的辅助类，要么采用第三方框架（比如 Spring 或 Pico），它们提供了基于代理（proxy）或者基于拦截器（interception）的上下文相关的会话。 </p><p>从 3.0.1 版本开始，Hibernate 增加了 <code class="literal">SessionFactory.getCurrentSession()</code> 方法。一开始，它假定了采用 <code class="literal">JTA</code> 事务，<code class="literal">JTA</code> 事务定义了当前 session 的范围和上下文（scope 和 context）。因为有好几个独立的 <code class="literal">JTA TransactionManager</code> 实现稳定可用，不论是否被部署到一个 <code class="literal">J2EE</code> 容器中，大多数（假若不是所有的）应用程序都应该采用 <code class="literal">JTA</code> 事务管理。基于这一点，采用 <code class="literal">JTA</code> 的上下文相关的会话可以满足你一切需要。 </p><p>更好的是，从 3.1 开始，<code class="literal">SessionFactory.getCurrentSession()</code> 的后台实现是可拔插的。因此，我们引入了新的扩展接口（<code class="literal">org.hibernate.context.CurrentSessionContext</code>）和新的配置参数（<code class="literal">hibernate.current_session_context_class</code>），以便对什么是当前会话的范围（scope）和上下文（context）的定义进行拔插。 </p><p>请参阅 <code class="literal">org.hibernate.context.CurrentSessionContext</code> 接口的 Javadoc，那里有关于它的契约的详细讨论。它定义了单一的方法，<code class="literal">currentSession()</code>，特定的实现用它来负责跟踪当前的上下文相关的会话。Hibernate 内置了此接口的三种实现： </p><div class="itemizedlist"><ul><li><p><code class="literal">org.hibernate.context.JTASessionContext</code>：当前会话根据 <code class="literal">JTA</code> 来跟踪和界定。这和以前的仅支持 JTA 的方法是完全一样的。详情请参阅 Javadoc。 </p></li><li><p><code class="literal">org.hibernate.context.ThreadLocalSessionContext</code>：当前会话通过当前执行的线程来跟踪和界定。详情也请参阅 Javadoc。 </p></li><li><p><code class="literal">org.hibernate.context.ManagedSessionContext</code>：当前会话通过当前执行的线程来跟踪和界定。但是，你需要负责使用这个类的静态方法将 <code class="literal">Session</code> 实例绑定、或者取消绑定，它并不会打开（open）、flush 或者关闭（close）任何 <code class="literal">Session</code>。 </p></li></ul></div><p>The first two implementations provide a "one session - one database transaction" programming model. This is also known and used as <span class="emphasis"><em>session-per-request</em></span>. The beginning and end of a Hibernate session is defined by the duration of a database transaction. If you use programmatic transaction demarcation in plain JSE without JTA, you are advised to use the Hibernate <code class="literal">Transaction</code> API to hide the underlying transaction system from your code. If you use JTA, you can utilize the JTA interfaces to demarcate transactions. If you execute in an EJB container that supports CMT, transaction boundaries are defined declaratively and you do not need any transaction or session demarcation operations in your code. Refer to <a class="xref" href="transactions.html" title="第 13 章 事务和并发">第 13 章 <i>事务和并发 </i></a> for more information and code examples. </p><p><code class="literal">hibernate.current_session_context_class</code> 配置参数定义了应该采用哪个 <code class="literal">org.hibernate.context.CurrentSessionContext</code> 实现。注意，为了向下兼容，如果未配置此参数，但是存在 <code class="literal">org.hibernate.transaction.TransactionManagerLookup</code> 的配置，Hibernate 会采用<code class="literal">org.hibernate.context.JTASessionContext</code>。一般而言，此参数的值指明了要使用的实现类的全名，但那三种内置的实现可以使用简写，即 "jta"、"thread" 和 "managed"。  </p></div></div><HR xmlns=""/><a xmlns="" href="legalnotice.html"><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">版权 © 2004 Red Hat, Inc.</p></a><ul class="docnav"><li class="previous"><a accesskey="p" href="tutorial.html"><strong>上一页</strong>第 1 章 教程</a></li><li class="up"><a accesskey="u" href="#"><strong>上一级</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>起始页</strong></a></li><li class="next"><a accesskey="n" href="session-configuration.html"><strong>下一页</strong>第 3 章 配置</a></li></ul></body></html>