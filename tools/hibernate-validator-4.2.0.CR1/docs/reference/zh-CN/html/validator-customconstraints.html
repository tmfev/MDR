<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">第 3 章 创建自己的约束规则</title><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="Hibernate Validator"/><link rel="up" href="index.html" title="Hibernate Validator"/><link rel="prev" href="validator-usingvalidator.html" title="第 2 章 Validation step by step"/><link rel="next" href="validator-xmlconfiguration.html" title="第 4 章 XML configuration"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="validator-usingvalidator.html"><strong>上一页</strong></a></li><li class="next"><a accesskey="n" href="validator-xmlconfiguration.html"><strong>下一页</strong></a></li></ul><div class="chapter" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customconstraints"/>第 3 章 创建自己的约束规则</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="validator-customconstraints.html#validator-customconstraints-simple">3.1. 创建一个简单的约束条件</a></span></dt><dd><dl><dt><span class="section"><a href="validator-customconstraints.html#validator-customconstraints-constraintannotation">3.1.1. 约束标注</a></span></dt><dt><span class="section"><a href="validator-customconstraints.html#validator-customconstraints-validator">3.1.2. 约束校验器</a></span></dt><dt><span class="section"><a href="validator-customconstraints.html#validator-customconstraints-errormessage">3.1.3. 校验错误信息</a></span></dt><dt><span class="section"><a href="validator-customconstraints.html#validator-customconstraints-using">3.1.4. 应用约束条件</a></span></dt></dl></dd><dt><span class="section"><a href="validator-customconstraints.html#validator-customconstraints-compound">3.2. 约束条件组合</a></span></dt></dl></div><p>尽管Bean Validation API定义了一大堆标准的约束条件, 但是肯定还是有这些约束不能满足我们需求的时候, 在这种情况下, 你可以根据你的特定的校验需求来创建自己的约束条件.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customconstraints-simple"/>3.1. 创建一个简单的约束条件</h2></div></div></div><p>按照以下三个步骤来创建一个自定义的约束条件</p><div class="itemizedlist"><ul><li><p>创建约束标注</p></li><li><p>实现一个验证器</p></li><li><p>定义默认的验证错误信息</p></li></ul></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-constraintannotation"/>3.1.1. 约束标注</h3></div></div></div><p>让我们来创建一个新的用来判断一个给定字符串是否全是大写或者小写字符的约束标注. 我们将稍后把它用在<a class="xref" href="validator-gettingstarted.html" title="第 1 章 开始入门">第 1 章 <i>开始入门</i></a>中的类<code class="classname">Car</code>的<span class="property">licensePlate</span>字段上来确保这个字段的内容一直都是大写字母.</p><p>首先,我们需要一种方法来表示这两种模式( 译注: 大写或小写), 我们可以使用<code class="classname">String</code>常量, 但是在Java 5中, 枚举类型是个更好的选择:</p><div class="example"><a id="d0e1629"/><p class="title"><b>例 3.1. 枚举类型<code class="classname">CaseMode</code>, 来表示大写或小写模式.</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;enum&nbsp;</span><span class="java_type">CaseMode</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;UPPER</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;LOWER</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>现在我们可以来定义真正的约束标注了. 如果你以前没有创建过标注(annotation)的话,那么这个可能看起来有点吓人, 可是其实没有那么难的 :)</p><div class="example"><a id="example-defining-custom-constraint"/><p class="title"><b>例 3.2. 定义一个CheckCase的约束标注</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">RetentionPolicy</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Documented</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Retention</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Target</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Constraint</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Payload</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ANNOTATION_TYPE&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Constraint</span><span class="java_separator">(</span><span class="java_plain">validatedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckCaseValidator</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Documented</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckCase</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;message</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{com.mycompany.constraints.checkcase}&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Payload</span><span class="java_operator">&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;payload</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">CaseMode</span><span class="java_plain">&nbsp;value</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>一个标注(annotation) 是通过<code class="code">@interface</code>关键字来定义的. 这个标注中的属性是声明成类似方法的样式的. 根据Bean Validation API 规范的要求</p><div class="itemizedlist"><ul><li><p><span class="property">message</span>属性, 这个属性被用来定义默认得消息模版, 当这个约束条件被验证失败的时候,通过此属性来输出错误信息.</p></li><li><p><span class="property">groups</span> 属性, 用于指定这个约束条件属于哪(些)个校验组(请参考<a class="xref" href="validator-usingvalidator.html#validator-usingvalidator-validationgroups" title="2.3. 校验组">第 2.3 节 “校验组”</a>). 这个的默认值必须是<code class="classname">Class&lt;?&gt;</code>类型到空到数组.</p></li><li><p><code class="classname">payload</code> 属性, Bean Validation API 的使用者可以通过此属性来给约束条件指定严重级别. 这个属性并不被API自身所使用. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>通过payload属性来指定默认错误严重级别的示例</p><pre class="programlisting">public class Severity {
    public static class Info extends Payload {};
    public static class Error extends Payload {};
}

public class ContactDetails {
    @NotNull(message="Name is mandatory", payload=Severity.Error.class)
    private String name;

    @NotNull(message="Phone number not specified, but not mandatory", payload=Severity.Info.class)
    private String phoneNumber;

    // ...
}</pre><p>这样, 在校验完一个<code class="classname">ContactDetails</code> 的示例之后, 你就可以通过调用<code class="methodname">ConstraintViolation.getConstraintDescriptor().getPayload()</code>来得到之前指定到错误级别了,并且可以根据这个信息来决定接下来到行为.</p></div></li></ul></div><p>除了这三个强制性要求的属性(<span class="property">message</span>, <span class="property">groups</span> 和 <span class="property">payload</span>) 之外, 我们还添加了一个属性用来指定所要求到字符串模式. 此属性的名称<span class="property">value</span>在annotation的定义中比较特殊, 如果只有这个属性被赋值了的话, 那么, 在使用此annotation到时候可以忽略此属性名称, 即<code class="code">@CheckCase(CaseMode.UPPER)</code>.</p><p>另外, 我们还给这个annotation标注了一些(所谓的) 元标注( 译注: 或"元模型信息"?, "meta annotatioins"): </p><div class="itemizedlist"><ul><li><p><code class="code">@Target({ METHOD, FIELD, ANNOTATION_TYPE })</code>: 表示@CheckCase 可以被用在方法, 字段或者annotation声明上.</p></li><li><p><code class="code">@Retention(RUNTIME)</code>: 表示这个标注信息是在运行期通过反射被读取的.</p></li><li><p><code class="code">@Constraint(validatedBy = CheckCaseValidator.class)</code>: 指明使用那个校验器(类) 去校验使用了此标注的元素.</p></li><li><p><code class="code">@Documented</code>: 表示在对使用了<code class="code">@CheckCase</code>的类进行javadoc操作到时候, 这个标注会被添加到javadoc当中.</p></li></ul></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-validator"/>3.1.2. 约束校验器</h3></div></div></div><p>接下来, 我们需要实现一个约束验证器, 它是被用来校验应用了<code class="classname">@CheckCase</code>标注到元素到. 如下面例子所示, 这个验证器需要实现ConstraintValidator接口.</p><div class="example"><a id="example-constraint-validator"/><p class="title"><b>例 3.3. 约束条件<code class="classname">CheckCase</code>的验证器</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintValidator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintValidatorContext</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckCaseValidator</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidator</span><span class="java_operator">&lt;</span><span class="java_type">CheckCase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">CaseMode</span><span class="java_plain">&nbsp;caseMode</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span><span class="java_type">CheckCase</span><span class="java_plain">&nbsp;constraintAnnotation</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">caseMode&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;constraintAnnotation</span><span class="java_separator">.</span><span class="java_plain">value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValid</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;object</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidatorContext</span><span class="java_plain">&nbsp;constraintContext</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">object&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">caseMode&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_type">CaseMode</span><span class="java_separator">.</span><span class="java_plain">UPPER</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;object</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">object</span><span class="java_separator">.</span><span class="java_plain">toUpperCase</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;object</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">object</span><span class="java_separator">.</span><span class="java_plain">toLowerCase</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p><code class="classname">ConstraintValidator</code>定义了两个泛型参数, 第一个是这个校验器所服务到标注类型(在我们的例子中即<code class="classname">CheckCase</code>), 第二个这个校验器所支持到被校验元素到类型 (即<code class="classname">String</code>).</p><p>如果一个约束标注支持多种类型到被校验元素的话, 那么需要为每个所支持的类型定义一个<code class="classname">ConstraintValidator</code>,并且注册到约束标注中.</p><p>这个验证器的实现就很平常了, <code class="methodname">initialize()</code> 方法传进来一个所要验证的标注类型的实例, 在本例中, 我们通过此实例来获取其value属性的值,并将其保存为<code class="classname">CaseMode</code>类型的成员变量供下一步使用.</p><p><code class="methodname">isValid()</code>是实现真正的校验逻辑的地方, 判断一个给定的<code class="classname">String</code>对于<code class="classname">@CheckCase</code>这个约束条件来说是否是合法的, 同时这还要取决于在<code class="classname">initialize()</code>中获得的大小写模式. 根据Bean Validation中所推荐的做法, 我们认为<code class="code">null</code>是合法的值. 如果<code class="code">null</code>对于这个元素来说是不合法的话,那么它应该使用<code class="code">@NotNull</code>来标注.</p><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1787"/>3.1.2.1. ConstraintValidatorContext</h4></div></div></div><p><a class="xref" href="validator-customconstraints.html#example-constraint-validator" title="例 3.3. 约束条件CheckCase的验证器">例 3.3 “约束条件CheckCase的验证器”</a> 中的<code class="methodname">isValid</code>使用了约束条件中定义的错误消息模板, 然后返回一个<code class="constant">true</code> 或者 <code class="constant">false</code>. 通过使用传入的<code class="classname">ConstraintValidatorContext</code>对象, 我们还可以给约束条件中定义的错误信息模板来添加额外的信息或者完全创建一个新的错误信息模板. </p><div class="example"><a id="example-constraint-validator-context"/><p class="title"><b>例 3.4. 使用ConstraintValidatorContext来自定义错误信息</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintValidator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintValidatorContext</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CheckCaseValidator</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidator</span><span class="java_operator">&lt;</span><span class="java_type">CheckCase</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">CaseMode</span><span class="java_plain">&nbsp;caseMode</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span><span class="java_type">CheckCase</span><span class="java_plain">&nbsp;constraintAnnotation</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">caseMode&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;constraintAnnotation</span><span class="java_separator">.</span><span class="java_plain">value</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValid</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;object</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ConstraintValidatorContext</span><span class="java_plain">&nbsp;constraintContext</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">object&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValid</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">caseMode&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_type">CaseMode</span><span class="java_separator">.</span><span class="java_plain">UPPER</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isValid&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;object</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">object</span><span class="java_separator">.</span><span class="java_plain">toUpperCase</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isValid&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;object</span><span class="java_separator">.</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">object</span><span class="java_separator">.</span><span class="java_plain">toLowerCase</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_plain">isValid</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintContext</span><span class="java_separator">.</span><span class="java_plain">disableDefaultConstraintViolation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintContext</span><span class="java_separator">.</span><span class="java_plain">buildConstraintViolationWithTemplate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{com.mycompany.constraints.CheckCase.message}&quot;</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">).</span><span class="java_plain">addConstraintViolation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;result</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p><a class="xref" href="validator-customconstraints.html#example-constraint-validator-context" title="例 3.4. 使用ConstraintValidatorContext来自定义错误信息">例 3.4 “使用ConstraintValidatorContext来自定义错误信息”</a> 演示了如果创建一个新的错误信息模板来替换掉约束条件中定义的默认的. 在本例中, 实际上通过调用<code class="classname">ConstraintValidatorContext</code>达到了一个使用默认消息模板的效果. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>提示</h2><p>在创建新的constraint violation的时候一定要记得调用<code class="methodname">addConstraintViolation</code>, 只有这样, 这个新的constraint violation才会被真正的创建.</p></div><p>In case you are implementing a <code class="classname">ConstraintValidator</code> a class level constraint it is also possible to adjust set the property path for the created constraint violations. This is important for the case where you validate multiple properties of the class or even traverse the object graph. A custom property path creation could look like <a class="xref" href="validator-customconstraints.html#example-custom-error" title="例 3.5. Adding new ConstraintViolation with custom property path">例 3.5 “Adding new ConstraintViolation with custom property path”</a>.</p><div class="example"><a id="example-custom-error"/><p class="title"><b>例 3.5. Adding new <code class="classname">ConstraintViolation</code> with custom property path</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">boolean</span><!-- <br/> --><span class="java_plain">&nbsp;isValid</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Group</span><!-- <br/> --><span class="java_plain">&nbsp;group</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ConstraintValidatorContext</span><!-- <br/> --><span class="java_plain">&nbsp;constraintValidatorContext</span><!-- <br/> --><span class="java_separator">)</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;isValid&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_separator">(</span><span class="java_operator">!</span><span class="java_plain">isValid</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintValidatorContext</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildConstraintViolationWithTemplate</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{my.custom.template}&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">addNode</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;myProperty&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">addConstraintViolation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;isValid</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-errormessage"/>3.1.3. 校验错误信息</h3></div></div></div><p>最后, 我们还需要指定如果<code class="classname">@CheckCase</code>这个约束条件验证的时候,没有通过的话的校验错误信息. 我们可以添加下面的内容到我们项目自定义的<code class="filename">ValidationMessages.properties</code> (参考 <a class="xref" href="validator-usingvalidator.html#section-message-interpolation" title="2.2.4. 验证失败提示信息解析">第 2.2.4 节 “验证失败提示信息解析”</a>)文件中.</p><div class="example"><a id="d0e1850"/><p class="title"><b>例 3.6. 为<code class="classname">CheckCase</code>约束定义一个错误信息</b></p><div class="example-contents"><pre class="programlisting">com.mycompany.constraints.CheckCase.message=Case mode must be {value}.</pre></div></div><br class="example-break"/><p>如果发现校验错误了的话, 你所使用的Bean Validation的实现会用我们定义在<code class="classname">@CheckCase</code>中message属性上的值作为键到这个文件中去查找对应的错误信息.</p></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-using"/>3.1.4. 应用约束条件</h3></div></div></div><p>现在我们已经有了一个自定义的约束条件了, 我们可以把它用在<a class="xref" href="validator-gettingstarted.html" title="第 1 章 开始入门">第 1 章 <i>开始入门</i></a>中的<code class="classname">Car</code>类上, 来校验此类的<span class="property">licensePlate</span>属性的值是否全都是大写字母.</p><div class="example"><a id="example-car-with-checkcase"/><p class="title"><b>例 3.7. 应用<code class="classname">CheckCase</code>约束条件</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Min</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Size</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Size</span><span class="java_separator">(</span><span class="java_plain">min&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">14</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">CheckCase</span><span class="java_separator">(</span><span class="java_type">CaseMode</span><span class="java_separator">.</span><span class="java_plain">UPPER</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licensePlate</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Min</span><span class="java_separator">(</span><span class="java_literal">2</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">manufacturer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;manufacturer</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">licensePlate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;licencePlate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">seatCount&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;seatCount</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getters&nbsp;and&nbsp;setters&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>最后,让我们用一个简单的测试来检测<code class="classname">@CheckCase</code>约束已经被正确的校验了:</p><div class="example"><a id="d0e1889"/><p class="title"><b>例 3.8. 演示<code class="classname">CheckCase</code>的验证过程</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">Assert</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">util</span><span class="java_separator">.</span><span class="java_type">Set</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ConstraintViolation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Validation</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Validator</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">ValidatorFactory</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">BeforeClass</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">junit</span><span class="java_separator">.</span><span class="java_type">Test</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CarTest</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;validator</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">BeforeClass</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setUp</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ValidatorFactory</span><span class="java_plain">&nbsp;factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Validation</span><span class="java_separator">.</span><span class="java_plain">buildDefaultValidatorFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;factory</span><span class="java_separator">.</span><span class="java_plain">getValidator</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;testLicensePlateNotUpperCase</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;dd-ab-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">car</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;Case&nbsp;mode&nbsp;must&nbsp;be&nbsp;UPPER.&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">().</span><span class="java_plain">getMessage</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Test</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;carIsValid</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;car&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_separator">(</span><span class="java_literal">&quot;Morris&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;DD-AB-123&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">4</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">ConstraintViolation</span><span class="java_operator">&lt;</span><span class="java_type">Car</span><span class="java_operator">&gt;&gt;</span><span class="java_plain">&nbsp;constraintViolations&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validator</span><span class="java_separator">.</span><span class="java_plain">validate</span><span class="java_separator">(</span><span class="java_plain">car</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">,</span><span class="java_plain">&nbsp;constraintViolations</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="zh-CN"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customconstraints-compound"/>3.2. 约束条件组合</h2></div></div></div><p>在<a class="xref" href="validator-customconstraints.html#example-car-with-checkcase" title="例 3.7. 应用CheckCase约束条件">例 3.7 “应用CheckCase约束条件”</a>中我们可以看到, 类<code class="classname">Car</code>的<span class="property">licensePlate</span>属性上定义了三个约束条件. 在某些复杂的场景中, 可能还会有更多的约束条件被定义到同一个元素上面, 这可能会让代码看起来有些复杂, 另外, 如果在另外的类里面还有一个<span class="property">licensePlate</span>属性, 我们可能还要把这些约束条件再拷贝到这个属性上, 但是这样做又违反了 DRY 原则.</p><p>这个问题可以通过使用组合约束条件来解决. 接下来让我们来创建一个新的约束标注<code class="classname">@ValidLicensePlate</code>, 它组合了<code class="classname">@NotNull</code>, <code class="classname">@Size</code> 和 <code class="classname">@CheckCase</code>:</p><div class="example"><a id="d0e1927"/><p class="title"><b>例 3.9. 创建一个约束条件组合<code class="classname">ValidLicensePlate</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">RetentionPolicy</span><span class="java_separator">.</span><span class="java_operator">*</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Documented</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Retention</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;java</span><span class="java_separator">.</span><span class="java_plain">lang</span><span class="java_separator">.</span><span class="java_plain">annotation</span><span class="java_separator">.</span><span class="java_type">Target</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Constraint</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_type">Payload</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">NotNull</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">validation</span><span class="java_separator">.</span><span class="java_plain">constraints</span><span class="java_separator">.</span><span class="java_type">Size</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">NotNull</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Size</span><span class="java_separator">(</span><span class="java_plain">min&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">,</span><span class="java_plain">&nbsp;max&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">14</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">CheckCase</span><span class="java_separator">(</span><span class="java_type">CaseMode</span><span class="java_separator">.</span><span class="java_plain">UPPER</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;METHOD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;FIELD</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ANNOTATION_TYPE&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Retention</span><span class="java_separator">(</span><span class="java_plain">RUNTIME</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Constraint</span><span class="java_separator">(</span><span class="java_plain">validatedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Documented</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">ValidLicensePlate</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;message</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{com.mycompany.constraints.validlicenseplate}&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Payload</span><span class="java_operator">&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;payload</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>我们只需要把要组合的约束标注在这个新的类型上加以声明 (注: 这正是我们为什么把annotation types作为了<code class="classname">@CheckCase</code>的一个target). 因为这个组合不需要额外的校验器, 所以不需要声明validator属性.</p><p>现在, 在<span class="property">licensePlate</span>属性上使用这个新定义的"约束条件" (其实是个组合) 和之前在其上声明那三个约束条件是一样的效果了.</p><div class="example"><a id="d0e1944"/><p class="title"><b>例 3.10. 使用<code class="classname">ValidLicensePlate</code>组合约束</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;com</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">mycompany</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Car</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ValidLicensePlate</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;licensePlate</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>The set of <code class="classname">ConstraintViolations</code> retrieved when validating a <code class="classname">Car</code> instance will contain an entry for each violated composing constraint of the <code class="classname">@ValidLicensePlate</code> constraint. If you rather prefer a single <code class="classname">ConstraintViolation</code> in case any of the composing constraints is violated, the <code class="classname">@ReportAsSingleViolation</code> meta constraint can be used as follows:</p><div class="example"><a id="d0e1969"/><p class="title"><b>例 3.11. <code class="classname">@ReportAsSingleViolation</code>的用法</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ReportAsSingleViolation</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;@</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">ValidLicensePlate</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;message</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;{com.mycompany.constraints.validlicenseplate}&quot;</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;groups</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">Payload</span><span class="java_operator">&gt;</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;payload</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_separator">{};</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div><HR xmlns=""/><a xmlns="" href=""><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">版权 © 2009 - 2011 Red Hat, Inc. &amp; Gunnar Morling</p></a><ul class="docnav"><li class="previous"><a accesskey="p" href="validator-usingvalidator.html"><strong>上一页</strong>第 2 章 Validation step by step</a></li><li class="up"><a accesskey="u" href="#"><strong>上一级</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>起始页</strong></a></li><li class="next"><a accesskey="n" href="validator-xmlconfiguration.html"><strong>下一页</strong>第 4 章 XML configuration</a></li></ul></body></html>